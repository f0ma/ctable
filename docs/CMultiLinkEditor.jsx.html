<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: CMultiLinkEditor.jsx</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: CMultiLinkEditor.jsx</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Link editor class.
 *
 * @arg this.props.column {Object} Table column.
 * @arg this.props.column.name {string} Column name
 * @arg this.props.column.editor_default {*} Editor default value
 *
 * @arg this.props.row {Object} Row to edit, null if add, first if batch.
 * @arg this.props.add {bool} Is adding.
 * @arg this.props.batch {bool} Is batch editing.
 * @arg this.props.onEditorChanges {CTable#OnEditorChanges} Editor changes callback.
 *
 */


class CMultiLinkEditor extends Component {

    constructor() {
        super();

        this.onInputChange = this.onInputChange.bind(this);
        this.onResetClicked = this.onResetClicked.bind(this);
        this.onNullClicked = this.onNullClicked.bind(this);
        this.onOtherEditorChanged = this.onOtherEditorChanged.bind(this);
        this.onUndoClicked = this.onUndoClicked.bind(this);

        this.onRemoveLink = this.onRemoveLink.bind(this);
        this.onAddLink = this.onAddLink.bind(this);

        this.onSelectDropdownClick = this.onSelectDropdownClick.bind(this);
        this.onOptionsInputChange = this.onOptionsInputChange.bind(this);

    }

    componentDidMount() {

        var self = this;

        this.setState({
            editor_value: (this.props.add || this.props.batch) ? this.props.column.editor_default : this.props.row[this.props.column.name],
                      editor_modified: false,
                      editor_valid: true,
                      select_dropdown_active: false,
                      options_history: clone(this.props.options[this.props.column.cell_link]),
                      options_current: clone(this.props.options[this.props.column.cell_link]),
                      options_input: "",
                      input_id: makeID()
        }, () => {this.validateAndSend()});


        this.props.getOptionsForField(this.props.column.name, "").then(w => {
            var opt = {};
            w.rows.forEach(q => { opt[q[w.keys[0]]] = q[w.label]; });
            self.setState({options_current: opt, options_history: {...opt, ...self.state.options_history}});
        });

    }

    validateAndSend() {
        this.sendChanges();
    }

    sendChanges(){
        if (this.props.row === null){
            this.props.onEditorChanges(this.props.column.name, true, this.state.editor_value, true);
        } else {
            this.props.onEditorChanges(this.props.column.name, this.state.editor_value == this.props.row[this.props.column.name], this.state.editor_value, true);
        }

    }

    onInputChange(e){
        this.setState({editor_value: e.target.value, editor_modified: true}, () => {this.validateAndSend()});
    }

    /**
     * Request to set value to NULL.
     *
     * @method
     * @listens CEditorFrame#cteditorreset
     */

    onResetClicked(){
        this.setState({editor_value: this.props.column.editor_default, editor_modified: true}, () => {this.validateAndSend()});
    }

    /**
     * Request to set value to Default
     *
     * @method
     * @listens CEditorFrame#cteditortonull
     */

    onNullClicked(){
        this.setState({editor_value: null, editor_modified: true}, () => {this.validateAndSend()});
    }

    /**
     * Request to set value to value at start editing.
     *
     * @method
     * @listens CEditorFrame#cteditorundo
     */

    onUndoClicked(){
        this.setState({editor_value: this.props.add ? this.props.column.editor_default : this.props.row[this.props.column.name] , editor_modified: false}, () => {this.validateAndSend()});
    }

    /**
     * Notifiaction for changes in some editor.
     *
     * @method
     * @listens CTable#cteditorchanged
     */

    onOtherEditorChanged(e){
        if(e.detail.initiator == this.props.column.name) return;
    }

    onSelectDropdownClick(){
        this.setState({select_dropdown_active: !this.state.select_dropdown_active}, () => {
            document.getElementById(this.state.input_id).focus();
        });

    }

    onOptionsInputChange(e){
        var self = this;

        this.setState({options_input: e.target.value}, () => {
            self.props.getOptionsForField(this.props.column.name, self.state.options_input).then(w => {
                var opt = {};
                w.rows.forEach(q => { opt[q[w.keys[0]]] = q[w.label]; });
                self.setState({options_current: opt, options_history: {...opt, ...self.state.options_history}});
            });
        });
    }


    onRemoveLink(e){
        var id = parseInt(unwind_button_or_link(e).dataset['value']);
        var selectedids = [];
        if (this.state.editor_value !== undefined &amp;&amp; this.state.editor_value !== null) {
            selectedids = this.state.editor_value.split(";").filter(x => {return x != "";}).map(x => {return parseInt(x)}).filter(x => x != id);
        }
        selectedids.sort();
        e.stopPropagation();
        this.setState({editor_value: selectedids.join(";"), editor_modified: true}, () => {this.validateAndSend()});
    }

    onAddLink(e){
        var id = parseInt(unwind_button_or_link(e).dataset['value']);
        var selectedids = [];
        if (this.state.editor_value !== undefined &amp;&amp; this.state.editor_value !== null) {
            selectedids = this.state.editor_value.split(";").filter(x => {return x != "";}).map(x => {return parseInt(x)});
        }
        if (selectedids.includes(id)) return;
        selectedids.push(id);
        selectedids.sort();
        this.setState({editor_value: selectedids.join(";"), select_dropdown_active: false, editor_modified: true}, () => {this.validateAndSend()});
    }

    render () {

        var self = this;

        var selectedids = [];

        if (self.state.editor_value !== undefined &amp;&amp; self.state.editor_value !== null) {
            selectedids = self.state.editor_value.split(";").filter(x => {return x != "";}).map(x => {return parseInt(x)});
        }

        var selectedkv = selectedids.map(x => {
           return  [x, self.state.options_history &amp;&amp; (x in self.state.options_history) ? String(self.state.options_history[x]) : ("("+x+")")];
        });


        //onBlur={this.dropdownMenuLeave}

        return   &lt;div class={cls("dropdown", self.state.select_dropdown_active ? "is-active is-hoverable" : "")} style="width:100%;">
                   &lt;div class="dropdown-trigger" style="width:100%;">
                   &lt;div class={cls("input", self.state.editor_valid ? "" : "is-danger")}  aria-haspopup="true" aria-controls="dropdown-menu" onClick={this.onSelectDropdownClick}  style="width:100%; height: auto;flex-flow: wrap; row-gap: 0.4em; min-height: 2.5em; min-width: 5em;">
                      {selectedkv.map(([id, label]) => {
                          return  &lt;div class="control">
                            &lt;div class="tags has-addons mr-2">
                              &lt;button class="tag" title={label+" ("+id+")"}>{label}&lt;/button>&lt;button class="tag is-delete" data-value={id} onClick={self.onRemoveLink}>&lt;/button>
                            &lt;/div>
                          &lt;/div>;
                      })}
                      &lt;span class="icon is-small">&lt;span class="material-symbols-outlined">arrow_drop_down&lt;/span>&lt;/span>
                   &lt;/div>
                   &lt;/div>
                   &lt;div class="dropdown-menu" role="menu">
                       &lt;div class="dropdown-content">
                           &lt;p class="dropdown-item">
                               &lt;input class="input" type="input" value={self.state.options_input} onInput={self.onOptionsInputChange} id={this.state.input_id}/>
                           &lt;/p>
                       &lt;/div>
                       &lt;div class="dropdown-content" style="overflow: auto; max-height: 12em;">
                           {self.state.options_current ? Object.keys(self.state.options_current).map(x => &lt;a class="dropdown-item" data-value={x} onClick={self.onAddLink}>{self.state.options_current[x]} ({x})&lt;/a>) : ""}
                       &lt;/div>
                   &lt;/div>
               &lt;/div>;
    }
}


// {aw_options.map(function(item){
// item_count += 1;
// return &lt;a href="" class={item_count == self.state.top_index ? "dropdown-item is-active" :  "dropdown-item"} id={item_count == self.state.top_index ? self.state.selected_id : null} onClick={self.menuItemClicked} data-value={item[0]}>{item[1]}&lt;/a>;})}

</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="CBoolCell.html">CBoolCell</a></li><li><a href="CColumnsPanel.html">CColumnsPanel</a></li><li><a href="CDateCell.html">CDateCell</a></li><li><a href="CEditorFrame.html">CEditorFrame</a></li><li><a href="CEditorPanel.html">CEditorPanel</a></li><li><a href="CFilesCell.html">CFilesCell</a></li><li><a href="CFilesEditor.html">CFilesEditor</a></li><li><a href="CHeaderTable.html">CHeaderTable</a></li><li><a href="CLineEditor.html">CLineEditor</a></li><li><a href="CLinkCell.html">CLinkCell</a></li><li><a href="CLinkEditor.html">CLinkEditor</a></li><li><a href="CMultiLinkCell.html">CMultiLinkCell</a></li><li><a href="CMultiLinkEditor.html">CMultiLinkEditor</a></li><li><a href="CMultilineTextCell.html">CMultilineTextCell</a></li><li><a href="CNumbersCell.html">CNumbersCell</a></li><li><a href="CPageTable.html">CPageTable</a></li><li><a href="CPlainTextCell.html">CPlainTextCell</a></li><li><a href="CSelectCell.html">CSelectCell</a></li><li><a href="CSelectEditor.html">CSelectEditor</a></li><li><a href="CSortingPanel.html">CSortingPanel</a></li><li><a href="CTable.html">CTable</a></li><li><a href="CTagsCell.html">CTagsCell</a></li><li><a href="CTiledMultiLinkEditor.html">CTiledMultiLinkEditor</a></li></ul><h3>Events</h3><ul><li><a href="CEditorFrame.html#event:cteditorreset">cteditorreset</a></li><li><a href="CEditorFrame.html#event:cteditortonull">cteditortonull</a></li><li><a href="CEditorFrame.html#event:cteditorundo">cteditorundo</a></li><li><a href="CTable.html#event:cteditorchanged">cteditorchanged</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Sat Nov 29 2025 00:48:41 GMT+0300 (Москва, стандартное время)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
